

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1. Acceso a los fenomenos &#8212; gvsig 0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../../../_static/gvSIG.ico"/>
    <link rel="top" title="gvsig 0 documentation" href="../../../../index.html" />
    <link rel="up" title="Acceso a datos tabulares" href="../acceso_a_datos_tabulares.html" />
    <link rel="next" title="2. Modificación de la estructura de un almacén" href="api_modificacion_de_la_estructura_de_un_almacen.html" />
    <link rel="prev" title="4. Creación de un nuevo almacén" href="api_creacion_de_un_nuevo_almacen.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api_modificacion_de_la_estructura_de_un_almacen.html" title="2. Modificación de la estructura de un almacén"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api_creacion_de_un_nuevo_almacen.html" title="4. Creación de un nuevo almacén"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">gvSIG Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Documentación de gvSIG (ES)</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../acceso_a_datos_tabulares.html" accesskey="U">Acceso a datos tabulares</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/gvsig_asoc.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1. Acceso a los fenomenos</a><ul>
<li><a class="reference internal" href="#acceso-basico">1.1. Acceso básico</a></li>
<li><a class="reference internal" href="#filtrado">1.2. Filtrado</a></li>
<li><a class="reference internal" href="#ordenacion">1.3. Ordenación</a></li>
<li><a class="reference internal" href="#contexto">1.4. Contexto</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="api_creacion_de_un_nuevo_almacen.html"
                        title="previous chapter">4. Creación de un nuevo almacén</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api_modificacion_de_la_estructura_de_un_almacen.html"
                        title="next chapter">2. Modificación de la estructura de un almacén</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/es/org.gvsig.fmap.dal/2.2/acceso_a_datos_tabulares/api_fenomenos.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <gcse:search></gcse:search>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script>
  (function() {
    var cx = '000928295531310476676:vy4vt1ahxhe';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="acceso-a-los-fenomenos">
<h1>1. Acceso a los fenomenos<a class="headerlink" href="#acceso-a-los-fenomenos" title="Permalink to this headline">¶</a></h1>
<div class="section" id="acceso-basico">
<h2>1.1. Acceso básico<a class="headerlink" href="#acceso-basico" title="Permalink to this headline">¶</a></h2>
<p>Dentro de este apartado veremos:</p>
<ul class="simple">
<li>Como recorrer los fenómenos de un shape.</li>
<li>Como manejarse con un conjunto de fenómenos.</li>
<li>Acciones asociadas a un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> para consultar
los valores de sus atributos.</li>
</ul>
<p>Veamos ahora a seguir este documento con un ejemplo simple. Accederemos a un fichero shape y recorreremos todos sus fenómenos.</p>
<p>Lo primero que tendremos que hacer será conseguir una instancia del <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DataManager.html">DataManager</a>
del API de acceso a datos. Esto se consigue mediante la llamada al método
estático, <em>getDataManager</em> de la clase <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DALLocator.html">DALLocator</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">manager</span> <span class="o">=</span> <span class="n">DALLocator</span><span class="o">.</span><span class="na">getDataManager</span><span class="o">();</span>
</pre></div>
</div>
<p>Una vez conseguido la instancia del <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DataManager.html">DataManager</a> , utilizaremos este para conseguir
una instancia de los <em>parámetros</em>  que necesitamos para acceder al <em>almacén</em> de
nuestro fichero <em>shape</em>. Para eso invocaremos al método <em>createStoreParameters</em>
indicándole el tipo de almacén al que queremos acceder.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createStoreParameters</span><span class="o">(</span><span class="s">&quot;Shape&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>En el caso de un <em>almacén</em> de tipo <em>shape</em>, el único parámetro que necesitaremos
será el nombre del fichero al que queremos acceder. Los <em>parámetros</em> se comportan
como un <em>Map</em>, así que asignaremos a la clave <em>shpfilename</em>, el nombre del fichero al
que queremos acceder.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="na">setDynValue</span><span class="o">(</span><span class="s">&quot;shpfilename&quot;</span><span class="o">,</span><span class="s">&quot;data/prueba.shp&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Una vez tenemos los <em>parámetros</em> del <em>almacén</em> al que queremos acceder preparados,
le indicaremos al <em>manager</em> que nos cree un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DataStore.html">DataStore</a> acorde a esos parámetros que
nos permita acceder a nuestro fichero. Esto se hará llamando al método <em>createStore</em>
pasándole como argumento los <em>parámetros</em> que ya hemos preparado. Esta llamada nos
devolverá un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureStore.html">FeatureStore</a> , y ya con el podremos acceder a sus fenómenos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="o">(</span><span class="n">FeatureStore</span><span class="o">)</span><span class="n">manager</span><span class="o">.</span><span class="na">createStore</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
</pre></div>
</div>
<p>Cuando ya disponemos del <em>store</em>, podemos utilizar este para acceder a sus fenómenos.
La forma mas simple de hacer esto seria visitar el almacen.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">store</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span> <span class="k">new</span> <span class="n">Visitor</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Feature</span> <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">obj</span><span class="o">;</span>
      <span class="o">...</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
</pre></div>
</div>
<p>Como alternativa a este metodo podemos usar el método <em>getFeatureSet</em>,
que nos devolverá un conjunto de fenómenos, <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a> , con el que podremos
operar.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">();</span>
</pre></div>
</div>
<p>Es importante entender que estas son las unicas formas de acceder a los
fenómenos de un <em>almacén</em>. Además estas nos
permiten dado un <em>almacén de datos</em> acceder de forma simultanea a sus fenómenos invocando desde
varias partes de la aplicación al método <em>accept</em> o <em>getFeatureSet</em> para obtener distintos conjuntos de datos.
Como norma general no deberemos usar un conjunto de fenómenos, <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a> .
desde varias partes de la aplicación simultáneamente. Si necesitamos acceder a los
datos del <em>almacén</em>, allá donde se necesite, se creará un nuevo conjunto de datos.</p>
<p>Los principales métodos de un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a> son:</p>
<ul class="simple">
<li><em>getDefaultFeatureType</em></li>
<li><em>getFeatureTypes</em></li>
<li><em>isEmpty</em></li>
<li><em>getSize</em></li>
<li><em>dispose</em></li>
<li><em>iterator</em></li>
<li><em>fastiterator</em></li>
</ul>
<p>Hacer una mención especial sobre los dos últimos métodos, <em>iterator</em> y
<em>fastiterator</em>. El primero, <em>iterator</em>, devuelve una nueva instancia de <a href="#id3"><span class="problematic" id="id4">Feature_</span></a>
cada vez que se invoca al método <em>next</em>. El segundo, <em>fastiterator</em> devuelve
siempre la misma instancia de :javadoc:<a href="#id1"><span class="problematic" id="id2">`</span></a>Feature &lt; al invocar al método <em>next</em>, alterando
el valor de esta de forma que está cargada con los valores del nuevo fenómeno.
Este comportamiento nos ahorra crear tantos objetos <a href="#id5"><span class="problematic" id="id6">Feature_</span></a> como elementos
tenga el conjunto, pero deberemos tener especial cuidado en no guardarnos
una referencia a los objetos <a href="#id7"><span class="problematic" id="id8">Feature_</span></a> así obtenidos ya que irán alterando su valor
conforme se itere sobre el conjunto.</p>
<p>El <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a>, ademas de los metodos para iterar sobre el tambien nos permite
visitarlo, siendo siempre recomendable utilizar este mecanismo frente al recorrido
mediante un iterador.</p>
<p>Volviendo al ejemplo sobre el que estábamos trabajando,
podemos obtener un iterador sobre el conjunto de todas los fenómenos
y recorrerlos. En el ejemplo accederemos al valor del atributo <em>NOMBRE</em>
del fenómeno y lo sacaremos por la salida estándar.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DisposableIterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span> <span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">it</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Tenemos también la opción de saltar directamente a una posición, pidiendo el <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/dispose/DisposableIterator.html">DisposableIterator</a>
con un índice. Podemos usar el <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/dispose/DisposableIterator.html">DisposableIterator</a> devuelto de la misma forma que con
el <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/dispose/DisposableIterator.html">DisposableIterator</a> normal, aunque el primer elemento devuelto será el que ocupa la posición
correspondiente al índice indicado:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DisposableIterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="k">while</span><span class="o">(</span> <span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">it</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Por último una vez hemos terminado de trabajar con el conjunto de fenómenos y el <em>almacén</em>
debemos informarles de ello, para que este libere todos los recursos que esté utilizando.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
<span class="n">store</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Es importante tener en cuenta algunas consideraciones.</p>
<p>Los elementos de un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a> son siempre del tipo <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> , pero si no
hemos indicado nada al respecto cuando creamos el conjunto, no deberemos asumir
que todos tienen la misma estructura, ya que dependiendo del tipo de <em>almacén</em> podemos
encontrarnos con que la estructura de estos puede cambiar de un elemento a otro. Más adelante
explicaremos como filtrar los conjuntos de fenómenos de forma que el tipo de elementos
sea único dentro de este.</p>
<p>Otro punto a tener en cuenta está relacionado con la implementación del recorrido
de los elementos de un conjunto. No deberemos asumir nada al respecto de esto. El
API no fija nada respecto a como debe implementar cada <em>almacén</em> el recorrido de sus
elementos. Puede haber <em>almacenes</em> que carguen todos sus elementos en memoria para ser recorridos
mientras que otros sólo mantengan en memoria el elemento que se va a devolver o incluso
otros que utilicen algoritmos de <em>cache</em> específicos para acelerar su acceso. En general
la implementación de los distintos <em>almacenes</em> que lleva de base esta librería tiende a
ser lo mas óptima posible, balanceando la carga en memoria y la velocidad de acceso, e
implementándose de una u otra forma en función de las características del <em>almacén</em>.</p>
<p>Por último es importante invocar a la acción <em>dispose</em> del conjunto de fenómenos cuando
dejemos de trabajar con él, así como de los <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/dispose/DisposableIterator.html">DisposableIterator</a> cuando dejemos de usarlos.
Dependiendo del tipo de <em>almacén</em>, esto puedo liberar recursos como ficheros abiertos en disco
o conexiones a BBDD. Así mismo cuando hayamos creado nosotros el <em>almacén</em>, debemos de
encargarnos de invocar a la acción <em>dispose</em> sobre este. Hay que
tener cuidado de no invocar a la acción <em>dispose</em> sobre un <em>almacén</em> asociado a una capa de
gvSIG. Será la propia capa de gvSIG la encargada de hacerlo cuando no lo necesite.</p>
<p>Veamos todo el código del ejemplo junto:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DataManager</span> <span class="n">manager</span><span class="o">;</span>
<span class="n">DataStoreParameters</span> <span class="n">params</span><span class="o">;</span>
<span class="n">FeatureStore</span> <span class="n">store</span><span class="o">;</span>
<span class="n">FeatureSet</span> <span class="n">features</span><span class="o">;</span>
<span class="n">Feature</span> <span class="n">feature</span><span class="o">;</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">DALLocator</span><span class="o">.</span><span class="na">getDataManager</span><span class="o">();</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createStoreParameters</span><span class="o">(</span><span class="s">&quot;Shape&quot;</span><span class="o">)</span>
<span class="n">params</span><span class="o">.</span><span class="na">setDynValue</span><span class="o">(</span><span class="s">&quot;shpfilename&quot;</span><span class="o">,</span><span class="s">&quot;data/prueba.shp&quot;</span><span class="o">);</span>
<span class="n">store</span> <span class="o">=</span> <span class="o">(</span><span class="n">FeatureStore</span><span class="o">)</span><span class="n">manager</span><span class="o">.</span><span class="na">createStore</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">();</span>

<span class="n">DisposableIterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span> <span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">it</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
<span class="n">store</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Aunque siempre se pueden utilizar iteradores para recorrer los elementos del
almacen, es recomendable cuando sea posible utilizar <em>visitors</em>. Estos nos
garantizan que se libreran los recursos de forma automatica sin tener que
ir invocando a los metos <em>dispose</em> del iterador o el conjunto de fenomenos.
El codigo usando <em>visitors</em> quedaria algo como:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DataManager</span> <span class="n">manager</span><span class="o">;</span>
<span class="n">DataStoreParameters</span> <span class="n">params</span><span class="o">;</span>
<span class="n">FeatureStore</span> <span class="n">store</span><span class="o">;</span>
<span class="n">FeatureSet</span> <span class="n">features</span><span class="o">;</span>
<span class="n">Feature</span> <span class="n">feature</span><span class="o">;</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">DALLocator</span><span class="o">.</span><span class="na">getDataManager</span><span class="o">();</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createStoreParameters</span><span class="o">(</span><span class="s">&quot;Shape&quot;</span><span class="o">)</span>
<span class="n">params</span><span class="o">.</span><span class="na">setDynValue</span><span class="o">(</span><span class="s">&quot;shpfilename&quot;</span><span class="o">,</span><span class="s">&quot;data/prueba.shp&quot;</span><span class="o">);</span>
<span class="n">store</span> <span class="o">=</span> <span class="o">(</span><span class="n">FeatureStore</span><span class="o">)</span><span class="n">manager</span><span class="o">.</span><span class="na">createStore</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
<span class="n">store</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span> <span class="k">new</span> <span class="n">Visitor</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Feature</span> <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">obj</span><span class="o">;</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
<span class="n">store</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Hasta aquí hemos visto como conseguir usar el API para llegar a obtener un objeto
<a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> . Pero, ¿ qué es un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> y qué servicios nos ofrece ?</p>
<p>La clase <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> representa a un fenómeno dentro del almacén. En él se aglutina
toda la información, ya sea alfanumérica o vectorial. Un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> se comporta
como un <em>Map</em> muy especializado en el que las <em>key</em> hacen referencia a los nombres
de los atributos del fenómeno y los <em>value</em> de estas al valor de estos atributos. Cada
atributo tiene su tipo, por lo que no hay limitación en cuanto a cuantos atributos
de tipo vectorial puede tener la definición de una <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> .</p>
<p>En <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> nos encontraremos un método <em>get</em> para acceder a los valores de los atributos
del fenómeno. Para facilitar el acceso se han añadido métodos de utilidad que nos
devuelven ya tipos concretos en lugar de <em>Object</em>. Así, en el ejemplo anterior,
se usa el <em>getString</em> para obtener el valor del atributo <em>NOMBRE</em> como un <em>String</em>.</p>
<p>Los métodos de acceso a los valores de los atributos de un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> son:</p>
<ul class="simple">
<li><em>get</em>, retorna el valor del atributo indicado como
un <em>Object</em>.</li>
<li><em>getInt</em>, retorna el valor del atributo como
un valor de tipo <em>int</em>.</li>
<li><em>getBoolean</em>, retorna el valor del atributo como
un valor de tipo <em>boolean</em>.</li>
<li><em>getLong</em>, retorna el valor del atributo como
un valor de tipo <em>long</em>.</li>
<li><em>getFloat</em>, retorna el valor del atributo como
un valor de tipo <em>float</em>.</li>
<li><em>getDouble</em>, retorna el valor del atributo como
un valor de tipo <em>double</em>.</li>
<li><em>getDate</em>, retorna el valor del atributo como
un valor de tipo <em>Date</em>.</li>
<li><em>getString</em>, retorna el valor del atributo como
un valor de tipo <em>String</em>.</li>
<li><em>getByte</em>, retorna el valor del atributo como
un valor de tipo <em>byte</em>.</li>
<li><em>getGeometry</em>, retorna el valor del atributo como
un valor de tipo <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/geom/Geometry.html">Geometry</a>.</li>
<li><em>getFeature</em>, retorna el valor del atributo como
un valor de tipo <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> .</li>
<li><em>getArray</em>, retorna el valor del atributo como
un valor de tipo <em>Object[]</em>.</li>
</ul>
<p>Para los tipos básicos, si el valor del
atributo pedido no es del tipo pedido se intentará
convertir a ese tipo y en caso de que no se pueda
se lanzará una excepción.</p>
<p>Conviene comentar sobre los últimos tres métodos.</p>
<p>En lo que se refiere al acceso a datos, los valores
de datos de tipo vectorial los trata como objetos de tipo
<a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/geom/Geometry.html">Geometry</a> . Este tipo de datos esta definido en la librería
de geometrías de gvSIG, <em>org.gvsig.fmap.geom</em> para más información
sobre las funcionalidades alrededor de este tipo consulte la
documentación de esta librería (ver en documentos relacionados).</p>
<p>En lo que respecta al método <em>getFeature</em>, está pensado para
dar soporte a fuentes de datos en las que un fenómeno dentro de
la fuente de datos tiene un atributo que a su vez es una estructura
compleja, con sus propios atributos y valores. La forma de
recuperar ese atributo <em>compuesto</em>, por referirnos a él de alguna
forma, será a través de este método.</p>
<p>En lo que respecta al método <em>getArray</em> viene a cubrir el hueco de
qué pasa cuando un atributo de un fenómeno está compuesto por una tupla
de valores. Para acceder a esta tupla de valores se usará este método
que nos la presentará como un array.</p>
<p>Ahora unas consideraciones sobre rendimientos.
En general es recomendable usar el nombre del atributo para acceder
a el valor de estos, ya que, para cada consulta podemos variar tanto en
orden como en cantidad los atributos de la <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> que deseamos. Sin embargo
en ocasiones puede resultar mas óptimo usar su <em>índice</em> para acceder
a él. Todos los métodos de acceso que acabamos de comentar están sobrecargados
de forma que podemos usar bien el nombre o bien su <em>índice</em>.</p>
<p>Veamos como podía usarse esta forma de acceso a los atributos en el
ejemplo anterior.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DisposableIterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span> <span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">featureType</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">featureType</span><span class="o">.</span><span class="na">getIndex</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">index</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">it</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Evidentemente, el cambio, así introducido no ha supuesto ninguna mejora
en el rendimiento. Ahora bien si asumimos que estamos trabajando con
un almacén de datos que sólo soporta un tipo de <a href="#id9"><span class="problematic" id="id10">Feature_</span></a> , como es
nuestro caso, podemos optimizar algo mas el acceso.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">featureType</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getDefaultFeatureType</span><span class="o">();</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">featureType</span><span class="o">.</span><span class="na">getIndex</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">);</span>

<span class="n">DisposableIterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span> <span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">index</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">it</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Esto sí que puede resultar en una ganancia considerable en rendimientos
cuando estemos accediendo a un <em>almacén</em> con un numero muy grande de
fenómenos.</p>
<p>Cabe resaltar que hemos utilizado en el ejemplo un par de métodos nuevos.
Por un lado podemos ver como dada un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> accedemos a su <em>tipo</em> mediante
el método <em>getType</em>, que nos devuelve un objeto del tipo <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureType.html">FeatureType</a> .
Y por otro lado, podemos obtener el <em>tipo</em> de los fenómenos de un <em>almacén</em>
mediante el método <a href="#id11"><span class="problematic" id="id12">getDefaultFeatureType_</span></a> . Hay que tener cuidado con el
uso de este método ya que cuando estemos trabajando con <em>almacenes</em> que
contengan <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a> de varios tipos, nos dará de forma arbitraria sólo
un tipo. Si queremos saber los tipos de fenómenos que contiene un
<em>almacén</em> deberemos invocar a <a href="#id13"><span class="problematic" id="id14">getFeatureTypes_</span></a> que nos devolverá una
lista de los <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureType.html">FeatureType</a> que tiene el <em>almacén</em>.</p>
<p>Puede ser conveniente repasar la referencia sobre:</p>
<ul class="simple">
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureSet.html">FeatureSet</a></li>
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/Feature.html">Feature</a></li>
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureType.html">FeatureType</a></li>
</ul>
</div>
<div class="section" id="filtrado">
<h2>1.2. Filtrado<a class="headerlink" href="#filtrado" title="Permalink to this headline">¶</a></h2>
<p>Dentro de este apartado veremos:</p>
<ul class="simple">
<li>Como obtener un conjunto de fenómenos filtrando
por tipo de fenómeno.</li>
<li>Como obtener un conjunto de fenómenos filtrando
por una condición en función de los atributos
de los fenómenos.</li>
</ul>
<p>Vamos a seguir trabajando sobre el ejemplo que hemos estado viendo en el
apartado anterior.  ¿ Como podemos obtener un subconjunto de fenómenos de
nuestro almacén ?</p>
<p>Para aplicar un filtro, este se aplicara en el momento de invocar al
método <em>getFeatureSet</em> de nuestro <em>almacén</em>. Para esto deberemos
construir un objeto <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureQuery.html">FeatureQuery</a> , rellenarlo con los valores con los
que queremos filtrar e invocar al <em>getFeatureSet</em> pasándole
ese <em>query</em>.</p>
<p>A la hora de filtrar los fenómenos de un almacén de datos, podemos hacerlo
llevándonos de dos tipos de criterios:</p>
<ul class="simple">
<li>Según el tipo de fenómeno</li>
<li>O según una condición de filtro en función de los valores
de los fenómenos del almacén.</li>
</ul>
<p>Por ejemplo podríamos asegurarnos que cuando nos recorremos los fenómenos
siempre nos da fenómenos del mismo tipo, para ello podríamos hacer:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">types</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureTypes</span><span class="o">();</span>
<span class="n">Iterator</span> <span class="n">typesIterator</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span> <span class="n">typesIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
  <span class="n">featureType</span> <span class="o">=</span> <span class="o">(</span><span class="n">FeatureType</span><span class="o">)</span><span class="n">typesIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">featureType</span><span class="o">.</span><span class="na">getFieldIndex</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">);</span>

  <span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
  <span class="n">query</span><span class="o">.</span><span class="na">setFeatureType</span><span class="o">(</span><span class="n">featureType</span><span class="o">);</span>
  <span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

  <span class="n">DisposableIterator</span> <span class="n">featuresIterator</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
  <span class="k">while</span><span class="o">(</span> <span class="n">featuresIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="o">(</span><span class="n">Feature</span><span class="o">)</span><span class="n">featuresIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">feature</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">index</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">featuresIterator</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
  <span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Primero averiguamos los tipos de fenómenos que contiene nuestro almacén,
y luego obtenemos los fenómenos filtrando por tipo. Para filtrar creamos
un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureQuery.html">FeatureQuery</a> a partir del <em>store</em>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
</pre></div>
</div>
<p>Indicamos que queremos filtrar por los fenómenos de un tipo
en concreto.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="na">setFeatureType</span><span class="o">(</span><span class="n">featureType</span><span class="o">):</span>
</pre></div>
</div>
<p>y por ultimo creamos el conjunto de fenómenos usando ese
filtro.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
</pre></div>
</div>
<p>Al igual que podiamos emplear <em>visitor</em> sobre un almacen para
acceder a sus fenomenos, cuando estamos aplicando un filtro
tambien podemos usar el concepto de <em>visitor</em>, ya que el
almacen dispone de un metodo <em>acept</em> que recibe un query.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">store</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span> <span class="k">new</span> <span class="n">Visitor</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">..</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">query</span>
<span class="o">);</span>
</pre></div>
</div>
<p>De forma similar a como filtramos por el tipo de fenómeno podemos
filtrar por una expresión en función de los atributos de los
fenómenos. Para ello deberemos crear un objeto <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/evaluator/Evaluator.html">Evaluator</a> con la
condición que deseemos. Así el código de filtrado podría ser:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span> <span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;NOMBRE like &#39;a%&#39;&quot;</span><span class="o">)</span> <span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Hay que tener en cuenta que podemos mezclar los dos tipos de filtro,
filtrando a su vez por los tipo de fenómeno y por una expresión.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span> <span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;NOMBRE like &#39;a%&#39;&quot;</span><span class="o">)</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFeatureType</span><span class="o">(</span><span class="n">featureType</span><span class="o">):</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>A la hora de aplicar un filtro a un <em>query</em>, debemos entregarle un objeto
de tipo <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/evaluator/Evaluator.html">Evaluator</a> . El <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DataManager.html">DataManager</a>  dispone de un evaluador por defecto
para la evaluación de expresiones, pero se pueden utilizar evaluadores
especializados para obtener mejores rendimientos.</p>
<p>Puede ser conveniente repasar la referencia sobre:</p>
<ul class="simple">
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureQuery.html">FeatureQuery</a></li>
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/evaluator/Evaluator.html">Evaluator</a></li>
<li><a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/DataManager.html">DataManager</a></li>
</ul>
</div>
<div class="section" id="ordenacion">
<h2>1.3. Ordenación<a class="headerlink" href="#ordenacion" title="Permalink to this headline">¶</a></h2>
<p>La ordenación de los fenómenos devueltos por <em>getFeatureSet</em> se realiza
de forma similar a como se aplican los filtros. El orden que queremos aplicar
a nuestra colección de fenómenos se indica al <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureQuery.html">FeatureQuery</a> a través del
método <em>getOrder</em>, que nos devuelve una objeto <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/fmap/dal/feature/FeatureQueryOrder.html">FeatureQueryOrder</a> .</p>
<p>Así para ordenar los registros de forma ascendente por el atributo &#8220;NOMBRE&#8221;
haríamos:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">getOrder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span> <span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;NOMBRE like &#39;a%&#39;&quot;</span><span class="o">)</span> <span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Nótese que se pueden especificar simultáneamente tanto condiciones de filtrado por
expresión, por tipo de fenómeno y a su vez con o sin una ordenación.</p>
<p>Si quisiésemos hacer una ordenación descendente en lugar de usar:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">order</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
</pre></div>
</div>
<p>Usaríamos</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">order</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">,</span><span class="kc">false</span><span class="o">);</span>
</pre></div>
</div>
<p>También es posible usar un <a class="reference external" href="http://downloads.gvsig.org/download/gvsig-desktop-testing/dists/2.3.0/javadocs/html/org/gvsig/tools/evaluator/Evaluator.html">Evaluator</a> para la ordenación. Por ejemplo,
podemos hacer que la ordenación no distinga mayúsculas de las minúsculas así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="na">getOrder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;lower(NOMBRE)&quot;</span><span class="o">),</span><span class="kc">true</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="contexto">
<h2>1.4. Contexto<a class="headerlink" href="#contexto" title="Permalink to this headline">¶</a></h2>
<p>En ocasiones nos encontramos que dependiendo de algunas condiciones ajenas
a los datos en si mismos, no seria necesario disponer de un conjunto completo
de los fenómenos de un <em>almacén</em>, y si el <em>almacén</em> conociese cierta
información podría realizar optimizaciones en como recoge o recorre los
fenómenos que contiene para devolverlos a la aplicación. Esta información
adicional que no forma parte de los filtros u ordenaciones es lo que
denominamos contexto.</p>
<p>Nótese que cuando se indica una información de contexto para que el <em>almacén</em>
haga uso de ella y optimizar el acceso a los datos, la información que
nos devuelve la consulta no sera rigurosa. Por ejemplo, cuando estamos accediendo
a un servicio remoto de recuperación de fenómenos para pintarlos, si suministramos
a la consulta información de la escala, este puede obviar traerse del servidor
los fenómenos que no sean representativos de la escala a la que se este
trabajando e incluso simplificar las geometrías para optimizarlas en
función de la escala a la que van a ser usadas. Esto constituiría una optimización
durante el pintado de los datos, pero la información descargada nadie nos asegura
que fuese rigurosa. Así cuando vallamos a usar los datos para aplicar geoprocesos
o estemos interesados en realizar edición sobre ellos, nunca deberíamos indicar
en la consulta información de contexto.</p>
<p>Actualmente la única información de contexto prefijada que se trata en la
librería de acceso a datos es la <em>escala</em>. Se puede indicar información de contexto
adicional a modo de pares clave-valor. Hay que tener en cuenta que aunque se
especifique información de contexto, si el <em>almacén</em> no sabe como tratar
esa información de contexto, esta no se usará.</p>
<p>Imaginemos que estamos trabajando con capas de puntos obtenidas a partir de
un vuelo LIDAR. La cantidad de fenómenos asociado a esa fuente de datos puede
ser altísima, así que a la hora de pintar esos fenómenos nos gustaría que
tratase de hacer todas las optimizaciones que pudiese y, muy probablemente,
el uso de la información de escala a la cual voy a usar esos datos permita
acelerar mucho su acceso. Así podríamos indicar esa información al
obtener la colección de fenómenos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">setScale</span><span class="o">(</span><span class="n">scale</span><span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Esta información de contexto podría acumularse a las otras informaciones de
ordenación o filtrado de una consulta.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">getOrder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span> <span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;NOMBRE like &#39;a%&#39;&quot;</span><span class="o">)</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setScale</span><span class="o">(</span><span class="n">scale</span><span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>Otra forma alternativa de indicar la escala como información de contexto seria:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">FeatureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">createFeatureQuery</span><span class="o">();</span>
<span class="n">query</span><span class="o">.</span><span class="na">getOrder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;NOMBRE&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span> <span class="n">manager</span><span class="o">.</span><span class="na">createExpresion</span><span class="o">(</span><span class="s">&quot;NOMBRE like &#39;a%&#39;&quot;</span><span class="o">)</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setQueryParameter</span><span class="o">(</span><span class="s">&quot;Scale&quot;</span><span class="o">,</span><span class="n">scale</span><span class="o">);</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getFeatureSet</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

<span class="o">...</span>

<span class="n">features</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</pre></div>
</div>
<p>De esta forma podrían indicarse otros valores de contexto que el
<em>almacén de datos</em> pueda utilizar para optimizar su consulta.</p>
<p>Es de recalcar que nadie nos garantiza que el <em>almacén</em> sepa hacer uso
de esa información para optimizar el acceso a los datos. Simplemente
ponemos a disposición del <em>almacén</em> esa información por si le puede ser
de utilidad. Y que si especificamos información de contexto, los datos
que devuelve la consulta no serán rigurosos.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="api_modificacion_de_la_estructura_de_un_almacen.html" title="2. Modificación de la estructura de un almacén"
             >next</a> |</li>
        <li class="right" >
          <a href="api_creacion_de_un_nuevo_almacen.html" title="4. Creación de un nuevo almacén"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">gvSIG Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Documentación de gvSIG (ES)</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../acceso_a_datos_tabulares.html" >Acceso a datos tabulares</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, gvSIG Association.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>